<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
